# 前端需求与用户故事

## 概述

本前端采用 React + Next.js + MUI，服务于网关系统的内部管理网页。所有页面采用多Tab分区，提升交互体验，避免滚动。

---

## 功能需求

### 1. 新建网关映射配置页面

页面采用Tab分区，包含如下配置区域：

#### 1.1 基本信息（Basic）
- 域名（Domain）
- 请求路径Pattern（Request Path Pattern）
- 后端转发路径（Backend Forward Path）
- 域名+路径Pattern唯一性校验
- CMDB项目下拉选择，数据来源于API，仅显示有权限的项目

#### 1.2 后端目标服务器（Targets）
- 支持添加多个目标服务器
- 每个目标服务器需填写：hostname、port、protocol、proxy（可选）、region、data center

#### 1.3 Cookie转发策略（Cookies）
- 策略选项：passthrough、persist
- 可为部分cookie name设置相反策略，支持完全匹配/部分匹配
- 输入需符合RFC标准

#### 1.4 Header配置（Headers）
- 支持添加多个Request Header和Response Header
- 每个Header需填写：Name、Value、Override（是否覆盖）

#### 1.5 错误页装饰（Response Body Decorator）
- 针对特定错误状态码配置目标页面路径（绝对或相对）

#### 1.6 访问限制（Limiters）
- 允许/拒绝模式（Allow/Deny），可动态添加多个IP或子网（IPv4/CIDR格式校验）
- 配置最大允许并发量和每分钟调用数（需至少有一项限制）
- 配置服务允许的请求方法（如GET/POST/PUT/DELETE等）

#### 1.7 全局设置
- 页面加载时调用API获取所有默认值和可用选项
- 页面加载时调用API获取所有标签和选项的多语言label，支持右上角切换语言

---

## 用户故事（User Stories）

### US-1: 基本信息配置
- 作为管理员，我希望能填写域名、请求路径Pattern和后端转发路径，并确保域名+路径唯一。
- 作为管理员，我希望有一个下拉列表能显示我有权限的对应CMDB项目名列表方便我匹配当前数据到我的项目。

### US-2: 目标服务器管理
- 作为管理员，我希望能为每条映射添加多个后端目标服务器，并填写其详细信息。
- 作为管理员，我希望能随时添加或删除目标服务器。

### US-3: Cookie转发策略
- 作为管理员，我希望能选择全局cookie转发策略，并为部分cookie name设置例外。
- 作为管理员，我希望输入cookie name时能获得格式校验提示。

### US-4: Header配置
- 作为管理员，我希望能为请求和响应分别添加多个Header，并设置是否覆盖。
- 作为管理员，我希望能随时添加或删除Header项。

### US-5: 错误页装饰（Response Body Decorator）
- 作为管理员，我希望能为特定错误码配置自定义错误页面路径。
- 作为管理员，我希望能随时添加或删除错误码配置。

### US-6: 访问限制（Limiters）
- 作为管理员，我希望能选择允许或拒绝某些IP或子网访问网关。
- 作为管理员，我希望输入IP或子网时能获得格式校验提示。
- 作为管理员，我希望能配置最大允许并发量和允许的每分钟call的数量，需要保障至少有一个相应的限制存在。
- 作为管理员，我希望能配置服务允许的请求方法。

### US-7: Tab分区交互
- 作为管理员，我希望所有配置项分布在不同Tab下，避免页面滚动，提升填写体验。

### US-8: 全局设置
- 当访问页面时，我希望先调用一个后台API，它提供了我所有上述选项的配置默认值和可用选项。
- 当访问页面时，我希望先调用一个后台API, 它会加载我当前页面所有标签和选项的多语言label，我的页面能根据右上角的语言选择来切换配置网页的显示文字。

---

## 用例（Use Cases）

1. 管理员进入页面，前端自动调用API获取所有默认值、可用选项和多语言label。
2. 管理员在Basic Tab选择CMDB项目、填写域名、路径等，系统校验唯一性。
3. 管理员在Targets Tab添加多个目标服务器。
4. 管理员在Cookies Tab配置转发策略和例外。
5. 管理员在Headers Tab配置请求和响应Header。
6. 管理员在Response Body Decorator Tab配置错误码页面。
7. 管理员在Limiters Tab配置IP限制、最大并发、每分钟调用数、请求方法，且至少有一项限制。
8. 管理员可随时切换页面语言，所有label即时切换。

---

## 其他说明
- 所有UI均采用MUI组件，风格统一现代。
- 所有表单项均需前端校验，确保数据有效性。
- 页面默认语言为英文，文档可用中文编辑。
