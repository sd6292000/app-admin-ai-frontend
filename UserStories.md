# User Stories for Gateway Admin Frontend & Backend

## 说明
- 本文档将需求拆解为适合3位初级开发工程师的User Stories，每个故事建议用时2-3天。
- 包含前端、后端、权限、搜索、数据管理等全流程。
- 每个故事包含目标、主要任务、验收标准。

---

## Story 1：基础页面与多语言切换
**目标**：实现主页面结构、Tab分区、右上角语言切换、全局表单配置API对接。

- 实现主页面AppBar（Logo、项目名、语言切换下拉框）。
- 实现多Tab分区（Basic、Backends、Cookies、Headers、Response Body Decorator、Limiters）。
- 实现全局Context，支持表单配置和语言切换。
- 页面加载时自动请求REST API获取所有表单配置和多语言label。
- 切换语言后所有label和选项即时切换。

**验收标准**：
- 页面结构美观，切换Tab无滚动。
- 切换语言后所有表单label/选项即时切换。
- 所有表单项的label、选项、校验规则均来自API。

---

## Story 2：数据列表与搜索筛选
**目标**：实现网关映射配置的数据列表页，支持关键字、域名等多条件搜索与筛选。

- 前端实现数据列表页，展示所有网关映射配置（分页）。
- 支持按关键字、域名、项目名等字段快速搜索。
- 支持按状态（启用/禁用）、所属项目等筛选。
- 搜索/筛选条件与URL参数联动，便于分享和回溯。
- 后端API支持分页、模糊搜索、条件筛选。

**验收标准**：
- 用户可通过关键字、域名等快速定位目标配置。
- 切换筛选条件、翻页、刷新后结果一致。
- 后端API返回数据准确，性能良好。

---

## Story 3：权限与访问控制（前端）
**目标**：根据用户权限动态控制页面可见性、可编辑性、可删除性。

- 登录后根据用户角色/权限（如admin、editor、viewer）动态渲染页面内容。
- 只读用户仅能查看数据，不能编辑/删除/新建。
- 编辑用户可修改、保存数据，但不能删除。
- 管理员可新建、编辑、删除所有数据。
- 无权限用户访问受限页面时显示无权限提示。
- 前端所有操作按钮（编辑、删除、保存）根据权限动态显示/禁用。

**验收标准**：
- 不同权限用户登录后页面内容、操作按钮完全不同。
- 无权限操作时有明确提示。

---

## Story 4：权限与访问控制（后端）
**目标**：后端API根据用户身份和权限校验所有操作，防止越权。

- 后端所有API接口需校验用户身份和权限。
- 只读用户API仅返回可见数据，禁止POST/PUT/DELETE。
- 编辑用户API允许PUT/POST，禁止DELETE。
- 管理员API允许所有操作。
- 无权限用户API直接返回403。
- 后端日志记录所有敏感操作。

**验收标准**：
- 任意用户无法通过API越权操作。
- 日志可追溯所有敏感操作。

---

## Story 5：BasicTab与表单校验
**目标**：实现BasicTab表单，支持域名、路径、CMDB项目选择，前端校验。

- 实现BasicTab表单，字段包括：Domain、Request Path Pattern、Backend Forward Path、CMDB Project。
- 所有字段必填，域名+路径唯一性校验（前端提示）。
- CMDB项目下拉选项从API获取。
- 表单项与全局formData context同步。
- 只读用户禁用所有输入项。

**验收标准**：
- BasicTab所有字段可填写、可选，校验生效。
- 校验不通过时有明确提示。
- 只读用户无法编辑。

---

## Story 6：BackendsTab（目标服务器 + DNS检测）
**目标**：实现后端目标服务器的增删、详细信息填写、Proxy设置、DNS检测功能、UI美化。

- 支持添加/删除多个后端目标服务器。
- 每个目标服务器字段：Hostname、Port、Protocol、Region、Data Center、Enable、Rewrite Host、Web Proxy设置（含Proxy Host/Port/Username/Password）。
- **新增：DNS检测功能**
  - 自动检测hostname的DNS解析状态（输入后1秒自动检测）
  - 手动DNS检测按钮，支持IPv4和IPv6解析
  - DNS检测结果显示（成功/失败/警告状态）
  - DNS检测详情对话框，显示解析到的IP地址和响应时间
  - 连接测试功能，测试到后端服务器的TCP连接
  - 连接测试结果显示（成功/失败状态和响应时间）
- Proxy设置启用时显示相关输入框。
- 每行1-2项，分组明显，UI宽松美观。
- 所有输入项与formData context同步。
- 只读用户禁用所有输入项和按钮。

**验收标准**：
- 可动态增删目标服务器，所有字段可填写。
- DNS检测功能正常，能正确解析hostname。
- 连接测试功能正常，能测试TCP连接。
- 检测结果显示清晰，状态图标正确。
- Proxy设置交互友好，UI分组明显。
- 只读用户无法编辑。

---

## Story 7：CookiesTab（Cookie策略）
**目标**：实现全局Cookie策略、例外Cookie的增删、格式校验、模糊匹配。

- 支持选择全局Cookie策略（下拉）。
- 支持添加/删除Excluded Cookie，输入时校验RFC6265。
- 每个Excluded Cookie支持Started With（模糊匹配）checkbox。
- 所有输入项与formData context同步。
- 只读用户禁用所有输入项和按钮。

**验收标准**：
- 可动态增删Excluded Cookie，校验生效。
- 只读用户无法编辑。

---

## Story 8：HeadersTab（请求/响应Header）
**目标**：实现请求/响应Header的增删、覆盖选项、UI美化。

- 支持添加/删除多个Request Header和Response Header。
- 每个Header字段：Name、Value、Override（checkbox）。
- 所有输入项与formData context同步。
- 只读用户禁用所有输入项和按钮。

**验收标准**：
- 可动态增删Header，所有字段可填写。
- 只读用户无法编辑。

---

## Story 9：Response Body Decorator（错误页映射）
**目标**：实现错误码与自定义页面路径的映射、格式校验、增删。

- 支持添加/删除多个Error Page Mapping。
- Status Code为数字，Page Path需为URI Path或完整URL，前端校验。
- 所有输入项与formData context同步。
- 只读用户禁用所有输入项和按钮。

**验收标准**：
- 可动态增删映射，校验生效。
- 只读用户无法编辑。

---

## Story 10：LimitersTab（访问限制）
**目标**：实现IP/CIDR规则、并发/频率限制、方法选择、格式校验。

- 支持添加/删除多个IP/CIDR规则，输入时校验IPv4或IPv4/CIDR。
- 支持配置最大并发、每分钟调用数、允许方法（多选checkbox）。
- 所有输入项与formData context同步。
- 只读用户禁用所有输入项和按钮。

**验收标准**：
- 可动态增删IP规则，所有限制项可填写。
- 校验生效，切换语言后label/选项同步切换。
- 只读用户无法编辑。

---

## Story 11：表单提交、编辑、删除与确认
**目标**：实现全局表单数据收集、提交、编辑、删除、弹窗确认、结果提示。

- Tab下方有提交、保存、删除按钮（按权限显示）。
- 点击后弹窗展示所有表单内容详情，用户确认后POST/PUT/DELETE到API。
- 提交成功/失败有明确提示。
- 只读用户无提交、保存、删除按钮。
- 后端API支持新建、编辑、删除、只读、权限校验。

**验收标准**：
- 所有Tab数据能被完整收集和提交。
- 弹窗内容美观，结果提示清晰。
- 权限校验严格。

---

## Story 12：整体UI美化与可用性提升
**目标**：提升整体UI的商业化、易用性和响应式体验。

- 所有表单、按钮、弹窗、分组等采用MUI最佳实践美化。
- 重要说明用Alert，分组用Divider，小标题加粗。
- 响应式布局，适配不同屏幕。
- 只读、禁用、不可见等状态有明显视觉区分。

**验收标准**：
- UI风格统一现代，操作区分明，移动端体验良好。
- 权限状态下UI反馈清晰。

---

## Story 13：实时监控仪表板
**目标**：实现网关运行状态的实时监控和历史数据分析。

- 实现实时流量监控（QPS、带宽、连接数）的图表展示。
- 实现响应时间统计（平均、P50、P95、P99）的折线图。
- 实现错误率监控（4xx、5xx错误统计）的柱状图。
- 实现后端服务健康状态监控的状态面板。
- 支持按域名、路径、后端服务器等维度筛选监控数据。
- 支持自定义时间范围查询（最近1小时、6小时、24小时、7天、30天）。
- 实现监控数据的实时刷新（每30秒自动更新）。

**验收标准**：
- 监控数据实时准确，图表展示清晰美观。
- 支持多维度筛选，查询性能良好。
- 时间范围选择灵活，数据加载快速。
- 页面响应式设计，支持移动端查看。

---

## Story 14：告警与通知系统
**目标**：实现监控阈值配置和多种通知方式。

- 实现监控阈值配置界面（响应时间、错误率、流量等）。
- 支持多种通知方式配置（邮件、短信、Webhook、钉钉、企业微信）。
- 实现告警级别分类（警告、严重、紧急）和升级策略。
- 实现告警历史记录和确认机制。
- 支持告警规则的启用/禁用和批量操作。
- 实现告警测试功能（发送测试通知）。

**验收标准**：
- 阈值配置界面友好，支持多种指标类型。
- 通知方式配置完整，支持主流IM工具。
- 告警历史记录清晰，支持确认和处理。
- 告警测试功能正常，通知及时送达。

---

## Story 15：日志管理与分析
**目标**：实现完整的请求/响应日志记录和分析功能。

- 实现完整的请求/响应日志记录（包含请求头、响应头、请求体、响应体）。
- 实现结构化日志搜索和过滤（按IP、状态码、响应时间、域名等）。
- 实现异常请求自动标记（慢查询、错误请求、异常IP）。
- 实现日志导出功能（CSV、JSON格式）。
- 实现日志归档和清理策略。
- 支持日志的实时查看和历史查询。

**验收标准**：
- 日志记录完整准确，包含所有必要信息。
- 搜索功能强大，支持多条件组合查询。
- 异常标记准确，便于问题排查。
- 导出功能正常，支持大数据量处理。

---

## Story 16：WAF（Web应用防火墙）配置
**目标**：实现Web应用防火墙功能，防护常见攻击。

- 实现SQL注入、XSS攻击检测规则配置界面。
- 支持自定义安全规则编写（正则表达式、逻辑规则）。
- 实现攻击IP自动封禁和黑名单管理。
- 实现安全事件统计和攻击报告。
- 支持WAF规则的启用/禁用和优先级设置。
- 实现WAF规则的测试功能。

**验收标准**：
- 检测规则配置灵活，支持常见攻击模式。
- 自定义规则编写简单，语法清晰。
- 攻击IP封禁及时，黑名单管理完善。
- 安全报告详细，便于安全分析。

---

## Story 17：API限流与熔断
**目标**：实现细粒度的API限流和熔断器功能。

- 实现基于用户、IP、API路径的细粒度限流配置。
- 实现熔断器配置（错误率阈值、恢复时间、半开状态）。
- 实现限流策略的可视化配置界面。
- 实现限流效果的实时监控。
- 支持限流规则的优先级和继承关系。
- 实现限流和熔断的测试功能。

**验收标准**：
- 限流配置精细，支持多种维度。
- 熔断器参数合理，防止服务雪崩。
- 监控效果实时，数据准确。
- 测试功能完善，便于验证。

---

## Story 18：认证与授权增强
**目标**：实现完整的认证授权体系。

- 实现JWT Token验证配置界面。
- 实现OAuth2.0集成（支持主流OAuth提供商）。
- 实现API Key管理和轮换功能。
- 实现用户会话管理和单点登录。
- 支持多种认证方式的组合使用。
- 实现认证日志和审计功能。

**验收标准**：
- JWT配置完整，支持多种算法。
- OAuth2.0集成稳定，支持主流提供商。
- API Key管理安全，支持自动轮换。
- 会话管理完善，支持单点登录。

---

## Story 19：配置版本管理
**目标**：实现配置的版本管理和回滚功能。

- 实现配置变更历史记录和版本对比功能。
- 实现一键回滚到历史版本。
- 实现配置模板管理和批量操作。
- 实现配置导入导出（JSON/YAML格式）。
- 支持配置的差异对比和合并。
- 实现配置变更的审批流程。

**验收标准**：
- 版本历史清晰，支持详细对比。
- 回滚功能稳定，数据一致。
- 模板管理完善，支持批量操作。
- 导入导出格式标准，兼容性好。

---

## Story 20：高级负载均衡
**目标**：实现多种负载均衡算法和健康检查。

- 实现多种负载均衡算法（轮询、权重、最少连接、IP哈希）。
- 实现后端服务器健康检查配置。
- 实现故障转移策略。
- 实现会话保持配置。
- 支持负载均衡的实时监控。
- 实现负载均衡的测试功能。

**验收标准**：
- 负载均衡算法正确，分发均匀。
- 健康检查及时，故障转移快速。
- 会话保持稳定，用户体验良好。
- 监控数据准确，便于优化。

---

## Story 21：缓存策略配置
**目标**：实现HTTP缓存和性能优化。

- 实现HTTP缓存头配置。
- 实现缓存规则设置（按路径、参数、Header）。
- 实现缓存失效策略和预加载。
- 实现缓存命中率统计和优化建议。
- 支持缓存的实时监控。
- 实现缓存的手动清理。

**验收标准**：
- 缓存配置灵活，支持多种策略。
- 缓存命中率高，性能提升明显。
- 监控数据准确，优化建议合理。
- 清理功能完善，操作简单。

---

## Story 22：运维工具集
**目标**：实现运维操作的自动化工具。

- 实现配置热重载和灰度发布。
- 实现服务重启/停止/扩容。
- 实现性能指标收集和基准测试。
- 实现系统资源监控（CPU、内存、磁盘、网络）。
- 支持运维操作的批量执行。
- 实现运维操作的审计日志。

**验收标准**：
- 热重载稳定，灰度发布安全。
- 服务操作可靠，批量执行高效。
- 监控数据准确，基准测试标准。
- 审计日志完整，操作可追溯。

---

## Story 23：问题诊断
**目标**：实现问题诊断和根因分析。

- 实现请求链路追踪（分布式追踪）。
- 实现性能瓶颈分析和优化建议。
- 实现错误根因分析和自动修复。
- 实现诊断报告生成和分享。
- 支持诊断工具的集成。
- 实现诊断历史记录。

**验收标准**：
- 链路追踪准确，覆盖完整。
- 瓶颈分析深入，建议可行。
- 根因分析准确，修复有效。
- 诊断报告详细，便于分享。

---

## Story 24：多租户管理
**目标**：实现多租户隔离和资源管理。

- 实现租户隔离配置。
- 实现资源配额管理。
- 实现租户间配置共享和模板。
- 实现计费和用量统计。
- 实现租户管理员权限控制。
- 支持租户的创建、删除、迁移。

**验收标准**：
- 租户隔离严格，数据安全。
- 资源配额合理，使用透明。
- 配置共享灵活，模板丰富。
- 计费准确，统计详细。

---

## Story 25：团队协作
**目标**：实现团队协作和权限管理。

- 实现用户角色和权限管理（超级管理员、租户管理员、开发者、运维、只读）。
- 实现操作审计日志和合规报告。
- 实现团队通知和协作工具。
- 实现知识库和文档管理。
- 支持团队的组织架构管理。
- 实现协作工作流。

**验收标准**：
- 权限管理精细，角色清晰。
- 审计日志完整，合规报告准确。
- 协作工具实用，通知及时。
- 知识库丰富，文档完善。

---

## 开发优先级建议

### 第一阶段（核心功能）：Story 1-12
- 基础页面和配置管理功能
- 权限控制和UI美化
- 建议3位开发者并行开发，每人负责4个Story

### 第二阶段（监控安全）：Story 13-18
- 监控仪表板和告警系统
- WAF和API限流功能
- 认证授权增强
- 建议2位开发者负责监控，1位负责安全

### 第三阶段（高级功能）：Story 19-25
- 版本管理和负载均衡
- 缓存和运维工具
- 多租户和团队协作
- 建议根据功能复杂度分配

---

## 技术栈建议

### 前端技术栈
- React 18 + Next.js 14
- Material-UI (MUI) 组件库
- TypeScript 类型安全
- React Query 数据管理
- Recharts 图表展示
- React Hook Form 表单管理

### 后端技术栈
- Spring Boot 3.x
- Spring Security 安全框架
- Spring Data JPA 数据访问
- Redis 缓存和会话管理
- Elasticsearch 日志存储
- Prometheus + Grafana 监控

### 部署架构
- Docker 容器化部署
- Kubernetes 编排管理
- Nginx 反向代理
- MySQL/PostgreSQL 主数据库
- Redis 缓存数据库

---

> 建议3位开发者可按Tab/功能/权限/搜索分工，每人每次领取1-2个User Story，2-3天内完成并自测。
> 后端开发需与前端协作，确保API、权限、日志、搜索等功能完整。
> 重点关注监控、安全、性能等核心功能，这些是网关管理系统的关键特性。 